webpackJsonp([10],{ZiX2:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("Dd8w"),n=i.n(o),a=i("//Fk"),s=i.n(a),r=i("Xxa5"),c=i.n(r),l=i("exGp"),d=i.n(l),f=i("+63v"),p=i("y1lO"),u={name:"positionList",inject:["reload"],components:{pagination:f.a},data:function(){return{isConfirm:!1,isEdit:!1,treedata:[],defaultProps:{label:"positionName",isLeaf:"leaf"},positionTable:[],showAssetsDialog:!1,firstLevel:!1,clickInfo:"",clickNode:null,editId:"",form:{positionName:"",parentPositionName:"",parentId:""},rules:{positionName:[{required:!0,message:"请输入位置名称",trigger:"change"},{required:!0,message:"请输入位置名称",trigger:"blur"}]},tableHeight:500,treeHeight:500,totalNum:0,myNode0:null,myResolve0:null,nodeObject:{},isEditRow:!1}},watch:{$route:function(){this.clickInfo&&this.getTable(this.clickInfo.id)}},methods:{loadNode:function(e,t,i){var o=this;return d()(c.a.mark(function n(){var a,s;return c.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==e.level){n.next=15;break}return o.myNode0=e,o.myResolve0=t,a=void 0,n.prev=4,n.next=7,o.getTree(0);case 7:a=n.sent,n.next=13;break;case 10:n.prev=10,n.t0=n.catch(4),a=n.t0;case 13:return i&&(o.clickInfo=a.find(function(e){return e.id===o.clickInfo.id})),n.abrupt("return",t(a));case 15:if(o.nodeObject[e.data.id+""]={node:e,resolve:t},!(e.level>3)){n.next=18;break}return n.abrupt("return",t([]));case 18:return s=void 0,n.prev=19,n.next=22,o.getTree(e.data.id);case 22:s=n.sent,n.next=28;break;case 25:n.prev=25,n.t1=n.catch(19),s=n.t1;case 28:console.log(s,1515),t(s);case 30:case"end":return n.stop()}},n,o,[[4,10],[19,25]])}))()},append:function(e,t){var i=this;return d()(c.a.mark(function o(){var n;return c.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return n=void 0,o.prev=1,o.next=4,i.getTree(e.data.id);case 4:n=o.sent,o.next=10;break;case 7:o.prev=7,o.t0=o.catch(1),n=o.t0;case 10:t&&(i.clickInfo=n.find(function(e){return e.id===i.clickInfo.id})),n.forEach(function(t){i.$refs.bigTree.append(t,e)}),e.expanded=!0;case 13:case"end":return o.stop()}},o,i,[[1,7]])}))()},showTable:function(e,t){this.clickNode=t,this.clickInfo=e,this.getTable(e.id)},del:function(e,t){var i=this;t?Object(p.k)({id:e,actionType:3}).then(function(e){i.reload()}):Object(p.k)({id:e,actionType:3}).then(function(e){i.loadNode(i.nodeObject[i.clickInfo.id+""].node,i.nodeObject[i.clickInfo.id+""].resolve),i.getTable(i.clickInfo.id)})},getTree:function(e){return new s.a(function(t,i){Object(p.E)({parentId:e}).then(function(e){var i=e.data.items;t(i)}).catch(function(e){i([])})})},getTable:function(e){var t=this;Object(p.D)(n()({parentId:e},this.$route.query)).then(function(e){t.positionTable=e.data.items,t.totalNum=e.data.total})},editParent:function(){this.isEditRow=!1,this.isEdit=!0,this.editId=this.clickInfo.id,0==this.clickInfo.parentId?this.createDialog(!0):this.createDialog(!1),this.form.positionName=this.clickInfo.positionName,this.form.parentPositionName=this.clickInfo.parentPositionName,this.form.parentId=this.clickInfo.parentId?this.clickInfo.parentId:""},editChildren:function(e){this.isEditRow=!0,this.isEdit=!0,this.editId=e.id,this.createDialog(!1),this.form.positionName=e.positionName,this.form.parentPositionName=e.parentPositionName,this.form.parentId=e.parentId?e.parentId:""},createDialog:function(e){this.showAssetsDialog=!0,this.firstLevel=e,e||(this.form.parentPositionName=this.clickInfo.positionName,this.form.parentId=this.clickInfo.id)},closeDialog:function(){this.showAssetsDialog=!1,this.isEdit=!1,this.editId="",this.form.positionName="",this.form.parentPositionName="",this.form.parentId=""},createAssets:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return console.log("error submit!!"),!1;e.isConfirm=!0,e.isEdit?Object(p.s)({id:e.editId,positionName:e.form.positionName,parentId:e.firstLevel?e.clickInfo.parentId:e.form.parentId}).then(function(t){e.isConfirm=!1,t.code?e.$message.error(t.msg):(e.$message.success(t.msg),e.isEditRow?(e.clickNode.childNodes=[],e.append(e.clickNode)):(e.clickNode.parent.childNodes=[],1===e.clickNode.level?e.loadNode(e.myNode0,e.myResolve0,!0):e.append(e.clickNode.parent,!0)),e.getTable(e.clickInfo.id),e.closeDialog(),e.isEdit=!1)}).catch(function(t){e.isConfirm=!1}):Object(p.j)({positionName:e.form.positionName,parentId:e.firstLevel?e.clickInfo.parentId:e.form.parentId}).then(function(t){e.isConfirm=!1,t.code?e.$message.error(t.msg):(e.$message({message:t.msg,center:!0,type:"success"}),e.firstLevel?(e.myNode0.childNodes=[],e.loadNode(e.myNode0,e.myResolve0)):(e.clickInfo&&(e.nodeObject[e.clickInfo.id+""].node.childNodes=[]),e.loadNode(e.nodeObject[e.clickInfo.id+""].node,e.nodeObject[e.clickInfo.id+""].resolve),e.getTable(e.clickInfo.id)),e.closeDialog())}).catch(function(t){e.isConfirm=!1})})}},created:function(){},updated:function(){var e=this;this.$nextTick(function(){e.tableHeight=window.innerHeight-e.$refs.positionRef.$el.offsetTop-110,e.treeHeight=window.innerHeight-e.$refs.bigTree.$el.offsetTop-110,console.log(e.tableHeight)})}},m={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e._m(0),e._v(" "),i("el-container",[i("div",{staticClass:"asideTree"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.createDialog(!0)}}},[e._v("添加一级位置")]),e._v(" "),i("div",{style:{overflow:"auto",height:e.treeHeight+"px"}},[i("el-tree",{ref:"bigTree",attrs:{"highlight-current":"",lazy:"",load:e.loadNode,props:e.defaultProps},on:{"node-click":e.showTable},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.node;return i("span",{staticClass:"span-ellipsis"},[i("span",{attrs:{title:o.label}},[e._v(e._s(o.label))])])}}])})],1)],1),e._v(" "),i("el-main",[i("div",[i("el-row",{staticClass:"tac",staticStyle:{"border-bottom":"1px solid #eeeeee","padding-bottom":"15px"}},[e.clickInfo?i("el-button",{attrs:{disabled:2==e.clickInfo.deep,type:"primary"},on:{click:function(t){return e.createDialog(!1)}}},[e._v("新增")]):e._e(),e._v(" "),e.clickInfo?i("el-button",{attrs:{type:"primary"},on:{click:e.editParent}},[e._v("编辑")]):e._e(),e._v(" "),e.clickInfo?i("el-button",{attrs:{disabled:!!e.clickInfo.parentId,type:"danger"},on:{click:function(t){return e.del(e.clickInfo.id,!0)}}},[e._v("删除一级位置")]):e._e()],1)],1),e._v(" "),i("div",[i("el-table",{ref:"positionRef",attrs:{data:e.positionTable,border:"","tooltip-effect":"dark","max-height":e.tableHeight}},[i("el-table-column",{attrs:{prop:"id",label:"ID",width:"50",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{label:"位置名称",prop:"parentPositionName",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{label:"子级位置名称名称",prop:"positionName",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){return e.editChildren(t.row)}}},[e._v("编辑")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(i){return e.del(t.row.id,!1)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),i("div",[i("pagination",{attrs:{totalNum:e.totalNum}})],1),e._v(" "),i("el-dialog",{attrs:{title:(e.isEdit?"编辑":"添加")+(e.firstLevel?"一级位置":"子级位置"),"close-on-click-modal":!1,visible:e.showAssetsDialog,"destroy-on-close":"",width:"450px",center:""},on:{"update:visible":function(t){e.showAssetsDialog=t},close:e.closeDialog}},[i("el-form",{ref:"form",attrs:{model:e.form,"label-width":"150px",rules:e.rules}},[e.firstLevel?e._e():i("el-form-item",{attrs:{label:"上级位置名称",required:""}},[i("el-input",{staticStyle:{width:"200px"},attrs:{disabled:"",maxlength:"20"},model:{value:e.form.parentPositionName,callback:function(t){e.$set(e.form,"parentPositionName",t)},expression:"form.parentPositionName"}})],1),e._v(" "),i("el-form-item",{attrs:{label:e.firstLevel?"一级位置名称":"子级位置名称",prop:"positionName",required:""}},[i("el-input",{staticStyle:{width:"200px"},attrs:{maxlength:"20"},model:{value:e.form.positionName,callback:function(t){e.$set(e.form,"positionName","string"==typeof t?t.trim():t)},expression:"form.positionName"}})],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{disabled:e.isConfirm,type:"primary"},on:{click:e.createAssets}},[e._v(e._s(e.isConfirm?e.isEdit?"修改中...":"创建中...":"确 定"))]),e._v(" "),i("el-button",{on:{click:function(t){e.showAssetsDialog=!1}}},[e._v("取消")])],1)],1)],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticStyle:{height:"50px","border-bottom":"1px solid #DFDCDC","margin-bottom":"10px"}},[t("span",{staticStyle:{"font-size":"24px","font-weight":"bold",color:"#614a4d"}},[this._v("位置设置")])])}]};var h=i("VU/8")(u,m,!1,function(e){i("bp/j")},"data-v-01e209c6",null);t.default=h.exports},"bp/j":function(e,t){}});
//# sourceMappingURL=10.b1f6d1264a9c9e87a924.js.map